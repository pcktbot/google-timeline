<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Timeline</title>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.9.4/mapbox-gl.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; font-family: system-ui, -apple-system, sans-serif; }
    #map { width: 100%; height: 100%; }

    /* Timeline date controls */
    #controls {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 1;
      background: #fff;
      border-radius: 8px;
      padding: 10px 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      font-size: 13px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    #controls label { font-weight: 500; color: #333; }
    #controls input[type="date"] {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 4px 6px;
      font-size: 13px;
    }
    .btn {
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: background 0.15s;
    }
    .btn-primary { background: #3b82f6; color: #fff; }
    .btn-primary:hover { background: #2563eb; }
    .btn-danger { background: #ef4444; color: #fff; }
    .btn-danger:hover { background: #dc2626; }
    .btn-outline { background: #fff; color: #333; border: 1px solid #ccc; }
    .btn-outline:hover { background: #f3f4f6; }
    .btn-sm { padding: 4px 8px; font-size: 12px; }
    .btn.active { background: #059669; color: #fff; border-color: #059669; }

    /* Status bar */
    #status {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 13px;
      display: none;
    }

    /* Trip panel */
    #trip-panel {
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 1;
      width: 300px;
      max-height: calc(100vh - 24px);
      overflow-y: auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      font-size: 13px;
    }
    #trip-panel .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      border-bottom: 1px solid #e5e7eb;
      font-weight: 600;
      font-size: 14px;
    }
    #trip-panel .panel-body { padding: 10px 14px; }

    /* Trip list */
    .trip-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 0;
      border-bottom: 1px solid #f3f4f6;
      cursor: pointer;
    }
    .trip-item:hover { background: #f9fafb; margin: 0 -14px; padding: 8px 14px; }
    .trip-color {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .trip-name { flex: 1; font-weight: 500; cursor: pointer; }
    .trip-count { color: #9ca3af; font-size: 12px; }
    .trip-eye {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      padding: 0 2px;
      line-height: 1;
      color: #ccc;
      flex-shrink: 0;
    }
    .trip-eye:hover { color: #6b7280; }
    .trip-eye.visible { color: #3b82f6; }

    /* New trip form */
    #new-trip-form { display: none; }
    #new-trip-form input[type="text"] {
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 6px 8px;
      font-size: 13px;
      margin-bottom: 8px;
    }
    #new-trip-form input[type="color"] {
      width: 32px;
      height: 28px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0;
      cursor: pointer;
    }
    .form-row { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }

    /* Active trip view */
    #active-trip { display: none; }
    .active-trip-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .active-trip-header h3 { flex: 1; margin: 0; font-size: 14px; }
    .trip-actions {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    /* Stop list */
    .stop-list { list-style: none; margin: 0; padding: 0; }
    .stop-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 0;
      border-bottom: 1px solid #f3f4f6;
    }
    .stop-num {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
      color: #fff;
      flex-shrink: 0;
    }
    .stop-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .stop-type { color: #9ca3af; font-size: 11px; }
    .stop-remove {
      background: none;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      font-size: 16px;
      padding: 0 4px;
      line-height: 1;
    }
    .stop-remove:hover { color: #ef4444; }
    .stop-drag {
      cursor: grab;
      color: #ccc;
      font-size: 14px;
      user-select: none;
    }
    .stop-drag:active { cursor: grabbing; }

    /* Move buttons */
    .stop-move {
      background: none;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      font-size: 12px;
      padding: 0 2px;
      line-height: 1;
    }
    .stop-move:hover { color: #3b82f6; }

    /* Route stats */
    .route-stats {
      background: #f3f4f6;
      border-radius: 4px;
      padding: 8px 10px;
      margin-top: 10px;
      font-size: 12px;
      color: #6b7280;
    }
    .route-stats strong { color: #374151; }

    /* Waypoint prompt */
    #waypoint-prompt {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.3);
      min-width: 280px;
    }
    #waypoint-prompt h4 { margin: 0 0 12px; font-size: 14px; }
    #waypoint-prompt input {
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 6px 8px;
      font-size: 13px;
      margin-bottom: 10px;
    }
    #waypoint-prompt .btns { display: flex; gap: 8px; justify-content: flex-end; }
  </style>
</head>
<body>
  <!-- Date controls -->
  <div id="controls">
    <label for="start">From</label>
    <input type="date" id="start" />
    <label for="end">To</label>
    <input type="date" id="end" />
    <button class="btn btn-primary" id="load">Load</button>
    <button class="btn btn-outline" id="show-all">Show All</button>
  </div>

  <!-- Map -->
  <div id="map"></div>

  <!-- Status -->
  <div id="status"></div>

  <!-- Trip panel -->
  <div id="trip-panel">
    <div class="panel-header">
      <span>Trips</span>
      <button class="btn btn-primary btn-sm" id="new-trip-btn">+ New Trip</button>
    </div>
    <div class="panel-body">
      <!-- New trip form -->
      <div id="new-trip-form">
        <input type="text" id="trip-name-input" placeholder="Trip name..." />
        <div class="form-row">
          <input type="color" id="trip-color-input" value="#e11d48" />
          <button class="btn btn-primary btn-sm" id="create-trip-btn">Create</button>
          <button class="btn btn-outline btn-sm" id="cancel-trip-btn">Cancel</button>
        </div>
      </div>

      <!-- Trip list -->
      <div id="trip-list"></div>

      <!-- Active trip detail -->
      <div id="active-trip">
        <div class="active-trip-header">
          <div class="trip-color" id="active-trip-color"></div>
          <h3 id="active-trip-name"></h3>
          <button class="btn btn-outline btn-sm" id="back-to-list">&larr;</button>
        </div>
        <div class="trip-actions">
          <button class="btn btn-outline btn-sm" id="select-stops-btn">Select Points</button>
          <button class="btn btn-outline btn-sm" id="drop-waypoint-btn">Drop Waypoint</button>
          <button class="btn btn-outline btn-sm" id="dim-map-btn">Dim Map</button>
          <button class="btn btn-primary btn-sm" id="generate-route-btn">Generate Route</button>
          <button class="btn btn-danger btn-sm" id="delete-trip-btn">Delete</button>
        </div>
        <ul class="stop-list" id="stop-list"></ul>
        <div class="route-stats" id="route-stats" style="display:none"></div>
      </div>
    </div>
  </div>

  <!-- Waypoint name prompt -->
  <div id="waypoint-prompt">
    <h4>Add Waypoint</h4>
    <input type="text" id="waypoint-name-input" placeholder="Name (optional)..." />
    <div class="btns">
      <button class="btn btn-outline btn-sm" id="waypoint-cancel">Cancel</button>
      <button class="btn btn-primary btn-sm" id="waypoint-confirm">Add</button>
    </div>
  </div>

  <script type="module" src="./frontend.ts"></script>
</body>
</html>
